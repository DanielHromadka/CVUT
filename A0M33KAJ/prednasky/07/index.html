<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<link rel="stylesheet" type="text/css" href="../../common/syntax/syntax.css" />
		<link rel="stylesheet" type="text/css" href="../../common/css/slides2.css" />
		<link rel="stylesheet" type="text/css" href="../../common/css/skin/cvut/skin.css" />
		<script src="../../common/js/oz.js" type="text/javascript"></script>
		<script src="../../common/js/slides2.js" type="text/javascript"></script>
		<script src="../../common/syntax/syntax.js" type="text/javascript"></script>
		<meta name="viewport" content="width=device-width,user-scalable=0" />
		<title>JavaScript &ndash; klíčové koncepty: this, new, prototype chain</title>
	<body>
		
<h1>JavaScript &ndash; klíčové koncepty: this, new, prototype chain</h1>

<section class="slide">
	<h2>JavaScript &ndash; klíčové koncepty: this, new, prototype chain</h2>
	<ul>
		<li>Webová interaktivní prezentace</li>
		<li>"?" zobrazí krátkou nápovědu</li>
		<li>Tisk jako obvykle</li>
		<li>Pro pokračování stiskněte mezerník</li>
	</ul>
</section>

<section class="slide">
	<h2>Obsah</h2>
	<ol>
		<li>JavaScript: opáčko</li>
		<li>Objekty, funkce a pole</li>
		<li>Pilíř 1: Uzávěry</li>
		<li>Pilíř 2: Klíčové slovo this</li>
		<li>Pilíř 3: Prototype chain</li>
		<li>Operátor new</li>
	</ol>
</section>

<section class="slide">
	<h2>Opáčko</h2>
	<ul>
		<li>Interpret v každém prohlížeči</li>
		<li>Pro nováčka obtížný: jazyk samotný vs. DOM</li>
		<li>Jazyk stále vyvíjen (aktuálně ES5&rArr;ES6&rArr;ES7), vznikají nové verze</li>
		<li>Neexistuje koncept tříd (obtížné porovnání s C++, Java, &hellip;)</li>
	</ul>
</section>

<section class="slide">
	<h2>Opáčko: primitivní datové typy</h2>
	<ul>
		<li>Číslo, bool, řetězec, null, undefined</li>
		<li>Předávané hodnotou</li>
	</ul>
	<pre data-syntax="js">
var a = 3;
var b = 0.1 + 0.2;
var c = "ahoj" + 'ahoj';
var e = null;
var f = undefined;
</pre>
</section>

<section class="slide">
	<h2>Opáčko: komplexní datové typy</h2>
	<ul>
		<li>Objekt = neuspořádaná množina dvojic (klíč, hodnota)</li>
		<li>Podobjekty: Array, Function, Date, RegExp</li>
		<li>Předávané odkazem</li>
	</ul>
	<pre data-syntax="js">
var a = {};               /* prázdný objekt */
var b = {c:3, "d":"hi"}; 
var e = [a, b];           /* pole o dvou položkách */
var f = function() {};
var g = /^.*/;            /* regulární výraz */
</pre>
</section>

<section class="slide">
	<h2>Opáčko: základní syntaktické prvky</h2>
	<ul>
		<li>Volitelný středník</li>
		<li>if, for, while, switch</li>
		<li><em>Type coercion</em></li>
	</ul>
	<pre class="section" data-syntax="js">
var a = 1 + "dva";
var b = {} + {};
if (0 == "") { /* ... */ }
if (undefined == null)  { /* ... */ }
if (undefined === null) { /* ... */ }
</pre>
</section>

<section class="slide">
	<h2>Objekty, funkce a pole</h2>
	<ul>
		<li>Objekt = neuspořádaná množina dvojic</li>
		<li>Klíč je řetězec</li>
		<li>Hodnota je cokoliv</li>
		<li>Pole je též objekt</li>
	</ul>
	<pre data-syntax="js">
var pole1 = [3, 2, 1];
var pole2 = [];

pole1.length == 3;
pole1[1]     == 2;
pole2.length == 0;

pole2.push(pole1);
</pre>
</section>

<section class="slide">
	<h2>Objekty, funkce a pole</h2>
	<ul>
		<li>Funkce je též objekt</li>
	</ul>
	<pre data-syntax="js">
var add = function(a, b) { return a+b; }
add.c = 123;
add(add.c, add["c"]);
</pre>
</section>

<section class="slide">
	<h2>Pilíř 1: Uzávěry</h2>
	<ul>
		<li>Jaký je obor platnosti proměnných?</li>
		<li>Funkci lze definovat uvnitř jiné funkce</li>
		<li>Proměnná existuje v rámci své funkce a všech jejích podfunkcí</li>
	</ul>
	<pre data-syntax="js">
var outer = function(a, b) {
	var inner = function(x) { return 2*x; }
	return a + inner(b);
}
</pre>
</section>

<section class="slide">
	<h2>Pilíř 1: Uzávěry</h2>
	<ul>
		<li>Co když použijeme proměnnou ve vnitřní funkci?</li>
		<li>Vznikne <em>uzávěra</em></li>
	</ul>
	<pre data-syntax="js">
var outer = function(a, b) {
	var inner = function() { return 2*b; }
	return a + inner();
}

var outer = function(a, b) {
	var inner = function() { return 2*b; }
	return inner;
}
</pre>
</section>

<section class="slide">
	<h2>Pilíř 2: Klíčové slovo <em>this</em></h2>
	<ul>
		<li>Jeden z nejkomplikovanějších konceptů jazyka</li>
		<li>Zásadní rozdíl oproti jiným: hodnota je určena při volání</li>
	</ul>
	<pre data-syntax="js">
var fun = function() { alert(this); }
fun(); /* ? */

var obj1 = { fun:fun };
var obj2 = { fun:fun };

obj1.fun(); /* this == obj1 */
obj2.fun(); /* this == obj2 */

fun == obj1.fun == obj2.fun
</pre>
</section>

<section class="slide">
	<h2>Pilíř 2: Klíčové slovo <em>this</em></h2>
	<ul>
		<li>Pokud je při volání před názvem funkce tečka, hodnota this je objekt vlevo</li>
		<li>Jinak je this globální jmenný prostor</li>
		<li>This lze explicitně určit</li>
	</ul>
	<pre data-syntax="js">
var fun = function() { alert(this); }

var obj1 = {};
var obj2 = {};

fun.call(obj1, arg1, ...);    /* this == obj1 */
fun.apply(obj2, [arg1, ...]); /* this == obj2 */
</pre>
</section>

<section class="slide">
	<h2>Pilíř 3: Prototype chain</h2>
	<ul>
		<li>Dva objekty je možno provázat</li>
		<li><pre data-syntax="js">
var obj1 = { klic:"hodnota" }; var obj2 = {};
obj2.vazba = obj1;
alert(obj2.vazba.klic); /* "hodnota" */
</pre>
		</li>
		<li>Existuje speciální neviditelná vazba, zvaná "prototype link"</li>
		<li>Prototype link se používá při přístupu k neexistujícím vlastnostem</li>
		<li><pre data-syntax="js">
var obj1 = { klic:"hodnota" }; 
var obj2 = Object.create(obj1);
alert(obj2.klic); /* "hodnota" */

obj2.__proto__ == obj1;
</pre>
		</li>
	</ul>
</section>

<section class="slide">
	<h2>Pilíř 3: Prototype chain</h2>
	<ul>
		<li>Říkáme, že jeden objekt je prototypem druhého</li>
		<li>Druhý nabízí vše, co první (+ možná něco navíc)</li>
		<li>Více prototype linků = prototype chain</li>
	</ul>
	<pre data-syntax="js">
var obj1 = { klic:"hodnota" }; 
var obj2 = Object.create(obj1);
var obj3 = Object.create(obj2);

obj3.klic = "jina hodnota";
obj1.jinyKlic = "jeste jina hodnota";

alert(obj2.klic);     /* "hodnota" */
alert(obj3.klic);     /* "jina hodnota" */
alert(obj3.jinyKlic); /* "jeste jina hodnota" */
</pre>
</section>

<section class="slide">
	<h2>Pilíř 3: odbočka</h2>
	<p class="sections">
		<q>Nepodporujeme atribut prototype, který je u všech objektů. Tento atribut je normou povolen a přidává do objektu nové metody a atributy (případně s danou hodnotou). Tento atribut jsme neimplementovali, protože by byl problém ho implementovat a jsme toho názoru, že je k ničemu.</q>
		<strong>— prohlížeč Links, projektová dokumentace</strong>
	</p>
	<style>
		q + strong.after { display: none; }
		q + strong { display: block; text-align: right; }
	</style>
</section>

<section class="slide">
	<h2>Pilíř 3: Prototype chain</h2>
	<ul>
		<li>Neexistuje koncept tříd</li>
		<li>OOP lze realizovat pomocí prototypů</li>
		<li>Vzor (třída) = rodičovský objekt</li>
		<li>Objekt (instance) = objekty s prototypovým odkazem na rodiče</li>
	</ul>
</section>

<section class="slide">
	<h2>Operátor new</h2>
	<ul>
		<li>Prototype link nelze vytvářet přímo (<code>x.__proto__</code>)</li>
		<li>Varianta 1: <code>Object.create</code></li>
		<li>Varianta 2: <code>new</code></li>
		<li>Každá funkce má (téměř prázdný) objekt <code>.prototype</code></li>
		<li>Zápis <code>new f</code> vytvoří nový objekt, nastaví mu <code>__proto__</code> na <code>f.prototype</code> a vykoná nad ním <code>f()</code></li>
	</ul>
</section>

<section class="slide">
	<h2>Operátor new</h2>
	<p><a href="img/prototype.svg" target="_blank">diagram</a></p>
	<pre data-syntax="js">
var F = function() {
	this.a = 1;
}
F.prototype.b = 2;

var f = new F();
f.c = 3;
</pre>
</section>

<section class="slide">
	<h2>Operátor new</h2>
	<ul>
		<li>Terminologický guláš: vlastnost <code>.prototype</code> vs. <code>__proto__</code></li>
		<li>Objekt ("instance") nemá příliš souvislost se svojí vytvořující funkcí</li>
		<li>Operátor <code>new</code> patří k nejsložitějším partiím jazyka</li>
		<li>Do prototypu funkce zpravidla vkládáme metody (neb ty mají být sdíleny)</li>
	</ul>
</section>

<section class="slide">
	<h2>Dědičnost pomocí prototypů</h2>
	<p><a href="img/inheritance.svg" target="_blank">diagram</a></p>
	<pre data-syntax="js">
var Parent = function() {}
Parent.prototype.hi = function() { return "hello"; }

var Child = function() {}
Child.prototype = Object.create(Parent.prototype);
/* alternativně: Child.prototype = new Parent(); */

var ch = new Child();
ch.hi(); /* "hello" */
</pre>
</section>

<section class="slide">
	<h2>Obohacování prototypů</h2>
	<pre data-syntax="js">
String.prototype.lpad = function(what, length) {
  var count = length - this.length;
  var padding = "";
  for (var i=0; i&lt;count; i++) { padding += what; }
  return padding + this;
}
</pre>
</section>

<section class="slide">
	<h2>...</h2>
	<p style="text-align:center; height:70%"><img src="img/yoda.jpg" style="height:100%"/></p>
</section>

<section class="slide">
	<h2>bind</h2>
	<pre data-syntax="js">
var f1 = function() { alert(this.name); }
var foo = { name:"foo" }
var bar = { name:"bar" }
f1.call(foo); /* "foo" */

var f2 = f1.bind(bar);
f2() /* "bar" */
</pre>
</section>

<section class="slide">
	<h2>bind</h2>
	<ul>
		<li>Funkce/metoda <code>bind</code> vrací novou funkci</li>
		<li>V nové funkci je <code>this</code> napevno definováno ve chvíli volání <code>bind</code></li>
		<li><code>bind</code> umí ještě další věci, ale toto je nejdůležitější</li>
		<li>Úkol: vyrobte <code>bind</code></li>
	</ul>
</section>

<section class="slide">
	<h2>bind</h2>
	<pre data-syntax="js">
Function.prototype.bind = function(newThis) {
	var func = this;
	return function() {
		return func.apply(newThis, arguments);
	}
}
</pre>
</section>

<section class="slide">
	<h2>bind &ndash; využití</h2>
	<pre data-syntax="js">
var Obj = function() {}
Obj.prototype.foo = function() {}

var bar = new Obj();
setTimeout(bar.foo, 100);

setTimeout(bar.foo.bind(bar), 100);

/* dtto addEventListener atp. */
</pre>
</section>

<section class="slide">
	<h2>Bonus</h2>

<p>Víte, co a proč udělá tato funkce?</p>
<pre data-syntax="js">
function s(a) {
    while (a.length) {
        var v = a.shift();
        setTimeout(a.push.bind(a, v), v);
    }
}
</pre>
</section>


<section class="slide">
	<h2>Prostor pro otázky</h2>
</section>

<footer>
	<a href="http://twitter.com/0ndras">twitter.com/0ndras</a>
	<a href="mailto:ondrej.zara@firma.seznam.cz">ondrej.zara@firma.seznam.cz</a>
</footer>

<script type="text/javascript">
	Syntax.all();
	new Presentation();
</script>

</body>
</html>
