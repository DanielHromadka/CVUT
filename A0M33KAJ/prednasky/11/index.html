<!doctype html>
<html>
	<head>
		<meta charset="utf-8" />
		<link rel="stylesheet" type="text/css" href="../../common/syntax/syntax.css" />
		<link rel="stylesheet" type="text/css" href="../../common/css/slides2.css" />
		<link rel="stylesheet" type="text/css" href="../../common/css/skin/cvut/skin.css" />
		<script src="../../common/js/oz.js" type="text/javascript"></script>
		<script src="../../common/js/slides2.js" type="text/javascript"></script>
		<script src="../../common/syntax/syntax.js" type="text/javascript"></script>
		<meta name="viewport" content="width=device-width,user-scalable=0" />
		<title>Nová JavaScriptová API</title>
	<body>
		
<h1>Nová JavaScriptová API</h1>

<section class="slide">
	<h2>Nová JavaScriptová API</h2>
	<ul>
		<li>Webová interaktivní prezentace</li>
		<li>"?" zobrazí krátkou nápovědu</li>
		<li>Tisk jako obvykle</li>
		<li>Pro pokračování stiskněte mezerník</li>
	</ul>
</section>

<section class="slide">
	<h2>Obsah</h2>
	<ol>
		<li>Geolocation</li>
		<li>Web Storage</li>
		<li>File API</li>
		<li>History API</li>
		<li>FlexBox</li>
		<li>Ostatní</li>
	</ol>
</section>

<section class="slide">
	<h2>Geolocation</h2>
	<ul>
		<li>Zjištění polohy uživatele</li>
		<li>Asynchronní</li>
		<li>Polohu zjišťuje prohlížeč nedefinovanými mechanismy</li>
		<li>GPS, IP, Názvy wifi AP, &hellip;</li>
	</ul>
</section>

<section class="slide">
	<h2>Geolocation: API</h2>
	<pre data-syntax="js">
var ok = function(position) {
	alert([position.coords.latitude, position.coords.longitude]);
}

var error = function(e) {
	alert(e.message);
}

navigator.geolocation.getCurrentPosition(ok, error);
</pre>
</section>

<section class="slide">
	<h2>Geolocation: další API</h2>
	<ul>
		<li><code>watchPosition</code> pro opakované sledování</li>
		<li><code>clearPosition</code> pro přerušení</li>
		<li>Nalezená pozice obsahuje také rychlost, směr, výšku, přesnost</li>
	</ul>
</section>

<section class="slide">
	<h2>Web Storage</h2>
	<ul>
		<li>Úložiště dat v prohlížeči</li>
		<li>Alespoň 5MB pro doménu</li>
		<li>Data se nikam neodesílají</li>
		<li>Triviální <a href="http://www.webdirections.org/blog/localstorage-perhaps-not-so-harmful/">synchronní</a> JS API</li>
	</ul>
</section>

<section class="slide">
	<h2>Web Storage: ukázka</h2>
	<pre data-syntax="js">
localStorage.setItem("a", "b");

localStorage.length == 1;
localStorage.key(0) == "a";
localStorage.getItem("a") == "b";

localStorage.removeItem("a");
</pre>
</section>

<section class="slide">
	<h2>Web Storage: další info</h2>
	<ul>
		<li>Ukládají se dvojice řetězců (klíč-hodnota)</li>
		<li>Storage je sdílena všemi skripty na doméně</li>
		<li>Slabé API s ohledem na kapacitu</li>
		<li><code>sessionStorage</code> je oddělené úložiště, trvanlivé jen do zavření prohlížeče</li>
	</ul>
</section>

<section class="slide">
	<h2>File API</h2>
	<ul>
		<li>Přístup k souborům na disku uživatele</li>
		<li>Uživatel musí soubor nejdříve "vybrat" (dragdrop, input)</li>
		<li>Metadata, čtení, odesílání (XHR2)</li>
	</ul>
</section>

<section class="slide">
	<h2>File API: objekt File</h2>
	<ul>
		<li><code>name</code></li>
		<li><code>size</code> v bajtech</li>
		<li><code>type</code> (MIME) &ndash; odhad prohlížeče / operačního systému</li>
	</ul>
</section>

<section class="slide">
	<h2>File API: objekt FileReader</h2>
<pre data-syntax="js">
var fr = new FileReader();
fr.addEventListener("load", function(e) {
	alert(e.result);
});

fr.readAsText(file);
/* fr.readAsDataURL(file); */
/* fr.readAsArrayBuffer(file); */
/* fr.readAsBinaryString(file); */
</pre>
</section>

<section class="slide">
	<h2>History API</h2>
	<ul>
		<li>Práce s URL stránky</li>
		<li>Pro stavové jednostránkové aplikace</li>
		<li>Podpora pro zpět/vpřed, záložky a permalinky</li>
	</ul>
</section>

<section class="slide">
	<h2>History API: hash</h2>
	<ul>
		<li>Práce s tzv. <em>fragment identifikátorem</em>, zkráceně též <em>hashem</em></li>
		<li><code>location.hash = "ahoj"</code></li>
		<li>Událost <code>hashchange</code> na objektu <code>window</code></li>
	</ul>
</section>

<section class="slide">
	<h2>HTML5 History API</h2>
	<ul>
		<li>Možnost změny celého URL (bez načení stránky)</li>
		<li>Funkce <code>history.pushState()</code> a <code>history.replaceState()</code></li>
		<li><code data-syntax="js">history.pushState(data, title, "/nove/URL")</code></li>
		<li>Událost <code>popstate</code> na objektu <code>window</code> vzniká při uživatelově interakci s historií</li>
	</ul>
</section>

<section class="slide">
	<h2>CSS3 Flexible Box</h2>
	<ul>
		<li>Nový pozicovací algoritmus do CSS</li>
		<li>Pro polohování boxů vedle sebe / pod sebe</li>
		<li>Náhrada za (slabý) float</li>
	</ul>
</section>

<section class="slide">
	<h2>CSS3 Flexible Box: základ</h2>
<pre data-syntax="xml">
&lt;div id="parent"&gt;
	&lt;div id="child1"&gt;&lt;/div&gt;
	&lt;div id="child2"&gt;&lt;/div&gt;
	&lt;div id="child3"&gt;&lt;/div&gt;
&lt;/div&gt;
</pre>
<pre data-syntax="css">
#parent {
	display: flex;
	flex-direction: row;
	justify-content: space-between;
}
</pre>
</section>

<section class="slide">
	<h2>CSS3 Flexible Box: relativní rozměry boxů</h2>
	<ul>
		<li><code>flex-grow</code> je relativní <em>síla růstu</em></li>
		<li><code>flex-shrink</code> je relativní <em>síla zmenšení</em></li>
		<li><code>flex-base</code> je základní rozměr (výška/šířka)</li>
	</ul>
</section>

<section class="slide">
	<h2>CSS3 Flexible Box: další vlastnosti</h2>
	<ul>
		<li><code>align-items</code> a <code>align-self</code> pro zarovnání v kolmé ose (<em>cross axis</em>)</li>
		<li><code>order</code> pro změnu pořadí v prvků</li>
		<li><code>flex-wrap</code> pro povolení/zakázání zalamování</li>
		<li><a href="http://jsfiddle.net/ondras/tGK7p/">Ukázka</a></li>
	</ul>
</section>

<section class="slide">
	<h2>Page Visibility API</h2>
	<ul>
		<li>Je stránka vidět?</li>
		<li>Událost <code>visibilitychange</code> na objektu <code>document</code></li>
		<li><code>document.hidden</code></li>
		<li><code>document.visibilityState</code> &ndash; <code data-syntax="js">"visible", "hidden", "prerender"</code></li>
	</ul>
</section>

<section class="slide">
	<h2>Fullscreen API</h2>
	<ul>
		<li>Možnost zobrazit <em>konkrétní HTML prvek</em> přes celou obrazovku</li>
		<li>Pouze z posluchače události</li>
		<li>Podpora dobrá, ale s různými názvy/prefixy</li>
		<li>Pseudotřída <code>:full-screen</code> či <code>:fullscreen</code> </li>
		<li><code>document.fullscreenElement</code>, <code>document.fullscreenEnabled</code> </li>
	</ul>
</section>

<section class="slide">
	<h2>Fullscreen API</h2>
	<pre data-syntax="js">
var elem = document.querySelector("#myvideo");

if (elem.requestFullscreen) {
	elem.requestFullscreen();
} else if (elem.msRequestFullscreen) {
	elem.msRequestFullscreen();
} else if (elem.mozRequestFullScreen) {
	elem.mozRequestFullScreen();
} else if (elem.webkitRequestFullscreen) {
	elem.webkitRequestFullscreen();
}
</pre>
</section>

<section class="slide">
	<h2>Fullscreen API</h2>
	<pre data-syntax="js">
if (document.exitFullscreen) {
	document.exitFullscreen();
} else if (document.msExitFullscreen) {
	document.msExitFullscreen();
} else if (document.mozCancelFullScreen) {
	document.mozCancelFullScreen();
} else if (document.webkitExitFullscreen) {
	document.webkitExitFullscreen();
}
</pre>
</section>

<section class="slide">
	<h2>FormData</h2>
	<ul>
		<li>Automatická serializace key-value dat do x-www-form-urlencoded</li>
		<li>Možno předat do <code>XMLHttpRequest::send()</code></li>
		<li>Možno postavit nad existujícím formulářem</li>
	</ul>
</section>

<section class="slide">
	<h2>FormData</h2>
	<pre data-syntax="js">
var fd = new FormData( [form] );

fd.append("key1", "value");
fd.append("key2", file, "filename");

var blob = new Blob([data...]);
fd.append("key3", blob);
</pre>
</section>

<section class="slide">
	<h2>IndexedDB</h2>
	<ul>
		<li>Transakční key-value databáze v prohlížeči</li>
		<li>Pro libovolné množství dat</li>
		<li>Zcela asynchronní API</li>
		<li>Databáze je persistentní per-origin</li>
	</ul>
</section>

<section class="slide">
	<h2>IndexedDB</h2>
	<pre data-syntax="js">
indexedDB.open("eshop").onsuccess = function(e) {
	var db = e.target.result; 
	db.createObjectStore("item");
}

indexedDB.open("eshop").onsuccess = function(e) { 
	var store = e.result.objectStore("item"); 
	var item = { name: "Sample", price: 100 };
	store.add(item);
}
</pre>
</section>

<section class="slide">
	<h2>IndexedDB</h2>
	<pre data-syntax="js">
indexedDB.open("eshop").onsuccess = function(e) {
	var store = e.result.objectStore("item"); 
	var request = store.openCursor();

	request.onsuccess = function(e) {
		var cursor = e.result;
		if (!cursor) { return; }
		alert(JSON.stringify(cursor.value));
		cursor.continue();
	}
}
</pre>
</section>

<section class="slide">
	<h2>Prostor pro otázky</h2>
</section>

<footer>
	<a href="http://twitter.com/0ndras">twitter.com/0ndras</a>
	<a href="mailto:ondrej.zara@firma.seznam.cz">ondrej.zara@firma.seznam.cz</a>
</footer>

<script type="text/javascript">
	Syntax.all();
	new Presentation();
</script>

</body>
</html>
